<!DOCTYPE html>
<html>
<head>
	<title>sean said ipsum</title>
	<link rel="stylesheet" href="../css/styles.css">
</head>
<body>
	<header class="header">
		<div class="header-container">
			<!-- <img class="sloan" src="../img/octa.jpg" /> -->
			<h2>sean said ipsum</h2>
		</div>
	</header>
	<div class="container">
		<p>Do you love Sloan? Do you need placeholder copy for your website, design, or other such project? Look no further.</p>
		<p><input type="button" value="I worship all your handsome words" onclick="generateIpsum()"></p>
		<p id="ipsum-container"></p>
		<footer>
		<p>Text acting strange? Too much punctuation? Something broken? Please <a href="mailto:me@ruhee.ca">report a bug</a>.<br />
		All lyrics &copy; Ferguson/Murphy/Pentland/Scott, otherwise known as Sloan. You should <a href="http://sloanmusic.com/#releases">buy their albums</a>.</p>
		<p class="twitter-links"><a href="https://twitter.com/ruhee_" class="twitter-follow-button" data-show-count="false" data-dnt="true">Follow @ruhee_</a>
          <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');
          </script>
          <a href="https://twitter.com/share" class="twitter-share-button" data-url="http://ruhee.ca/sloan-ipsum" data-via="ruhee_" data-dnt="true">Tweet</a></p>
	</footer>
	</div>

	<script type="text/javascript" src="../data/sloan.js"></script>
	<script type="text/javascript">
		function generateIpsum() {
			var paragraphLength = generateParagraphLength();
			var ipsumText = '';
			var chainedLines = 0;

			// Known broken stuff:
			// looping strings split at apostrophe is failing (undefined or repeated strings)
			// some lines with commas are breaking the line that follows (probably because of spaces)

			// TODO:
			// make multi-paragraph selector and generate based on that
			// convert checks to regexes, lazybones

			for(var i = 0; i < paragraphLength; i++) {
				var ipsumLine = lyrics[Math.floor(Math.random()*lyrics.length)];
				// var ipsumLine = lyrics[239];

				// uncapitalize line if chained together with commas
				if(ipsumText.trim().slice(-1) == ',') {
					if(ipsumLine.slice(0,2) != 'I ' && ipsumLine.slice(0,2) != "I'") {
						ipsumLine = uncapitalize(ipsumLine);
					}

					// catch leading apostrophes and parentheticals, uncapitalize second char there instead
					// YES this is redundant and ugly. TODO: fix once strings are all coming back ok
					if(ipsumLine.slice(0,1) == '(' || ipsumLine.slice(0,1) == "'") {
						if(ipsumLine.slice(0,1) == '(' && (ipsumLine.slice(1,3) != 'I ' && ipsumLine.slice(1,3) != "I'")) {
							var newLine = ipsumLine.split('(');
							newLine[1] = uncapitalize(newLine[1]);
							ipsumLine = '(' + newLine[1];
						}
						else if(ipsumLine.slice(0,1) == "'") {
							var newLine = ipsumLine.split("'");
							newLine[1] = uncapitalize(newLine[1]);
							console.log(newLine)
							ipsumLine = "'";

							for(var j = 1; j <= newLine.length; j++) {
								ipsumLine += newLine[i]

							}
						}
					}

				}


				// randomly decide whether to string into longer sentence
				// todo: un-uglify
				if(randBoolean() && i < paragraphLength-1 && chainedLines < 4) {
					if(ipsumLine.slice(-1) != '.' && ipsumLine.slice(-1) != '?'){
						ipsumLine += ', ';
					}
					else {
						ipsumLine = ipsumLine.slice(0, -1) + ', ';
					}
					chainedLines++;
				}
				else {
					if(ipsumLine.slice(-1) != '.' && ipsumLine.slice(-1) != '?'){
						ipsumLine += '. ';
					}
					else {
						ipsumLine += ' ';
					}
					chainedLines = 0;
				}

				ipsumText += ipsumLine;
			}

			var ipsumContainer = document.getElementById('ipsum-container');
			ipsumContainer.innerText = ipsumText;
		}

		function generateParagraphLength() {
			return Math.floor(Math.random() * 8 + 8);
		}

		// just randomly return true or false, mostly for punctuation adding
		function randBoolean() {
			return !!Math.floor(Math.random() * 2);
		}

		function uncapitalize(str) {
			return str.substr(0,1).toLowerCase() + str.substr(1);
		}
	</script>
</body>
</html>